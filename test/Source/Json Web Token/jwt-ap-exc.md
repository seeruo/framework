---
title: JWT(json web token)应该场景研究笔记
type: JWT
date: 2018-12-25 11:30
tags: JWT,json web token, TOKEN
---
之前接触jwt的时候，只是知道jwt是无状态的客户端存储信息的身份认证方式，当时就觉得这个东西很不错，应用场景应该很广

前端时间公司重构一个项目，项目架构需要前后端分离，当然这种架构需要无状态认证，所以当时选择了JWT；
之后在开发中才发现很多问题需要处理，这里梳理一下，对jwt主要应用场景做个笔记


### 先说说jwt的特点
这些常识性的问题我就不多记录了；[JSON Web Token 入门教程](http://www.ruanyifeng.com/blog/2018/07/json_web_token-tutorial.html)
1. JWT 默认是不加密，但也是可以加密的。生成原始 Token 以后，可以用密钥再加密一次。
2. JWT 不加密的情况下，不能将秘密数据写入 JWT。
3. JWT 不仅可以用于认证，也可以用于交换信息。有效使用 JWT，可以降低服务器查询数据库的次数。
4. JWT 的最大缺点是，由于服务器不保存 session 状态，因此无法在使用过程中废止某个 token，或者更改 token 的权限。也就是说，一旦 JWT 签发了，在到期之前就会始终有效，除非服务器部署额外的逻辑。
5. JWT 本身包含了认证信息，一旦泄露，任何人都可以获得该令牌的所有权限。为了减少盗用，JWT 的有效期应该设置得比较短。对于一些比较重要的权限，使用时应该再次对用户进行认证。
6. 为了减少盗用，JWT 不应该使用 HTTP 协议明码传输，要使用 HTTPS 协议传输。


### JWT不适应的场景
很多人开始接触jwt的时候，估计都会犯一个错误，认为jwt完全可以取代seesion，做身份认证或者状态管理之类的需求。
先简单看看jwt的工作流程
1. 服务端把用户的信息(除开敏感信息)一起encode之后存入jwt, 并把jwt交给客户端
2. 客户端收到jwt，下次请求的时候带上jwt，
3. 服务端收到jwt进程decode(jwt)处理，得到用户信息，进行业务处理，并返回处理结果
在这个流程中间，服务端并没有存储用户的身份信息/状态信息，所有的身份及状态信息都是通过解析jwt而得来。
那么如果我在需要对客户端与服务端的会话进行管理的时候，怎么办呢？
比如说：
1. 统计在线人数
2. 禁止某人登陆系统
那么这种情况下，jwt是无法满足的，因为服务端根本没有管理策略所需要的数据对象

### JWT适应的场景
根据上面的分析，不适合的主要是需要会话管理的场景，而我们大部分业务系统都是需要做会话管理，除了一些简单的小网站

jwt最适合做的事情，主要在单次验证，验证完成之后不能再次使用，
为什么说不能再次使用？因为如果可以重复使用，那么每次的操作都是有效的，因为每次的jwt都是正确的
应用场景：
1. 密码修改
2. 邮箱验证
